<!doctype html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Miki 3</title>
    </head>
    <body>

     <div style="width: 100%; display: table;">
        <div style="width: 100%; display: table-row">
            <input type="text" id="currPath" style="width: 100%;" />
        </div>
        <div style="display: table-row">
            <div style="width: 15%; display: table-cell;">
                <ul id="contentsList" style="list-style-type:none">
                    <li>Some list item</li>
                </ul>
            </div>
            <div style="display: table-cell;">
                <div id="contentPage">
                </div>
            </div>
        </div>
    </div>

    </body>
    <script type='text/javascript'>
        var displayedPath = document.getElementById('currPath');

        var contentsList = document.getElementById("contentsList");
        contentsList.addEventListener('click', function(event){
            var thisPath = event.target.getAttribute('data-item-path');
            if (event.target.getAttribute('data-item-type') == 'd')
            {
                displayedPath.value = thisPath;
                JSAccessorInst.get(thisPath, Module.ResourceType.Folder);
            }
            else
            {
                JSAccessorInst.get(thisPath, Module.ResourceType.Page);
            }
        });

        var contentPage = document.getElementById('contentPage');

        var rootPath = "/pages/";

        var JSAccessorInst = {};
        var Module = {
            'print': function(text) { console.log('STDOUT: ' + text); },
            'printErr': function(text) { console.log('STDERR: ' + text); },
            onRuntimeInitialized: function() {
                var JSAccessor = Module.Accessor.extend("Accessor", {
                    onFolder: function(payload) {
                        contentsList.innerHTML = '';
                        // Insert .. => previous path, if not root
                        if ((displayedPath.value + "/") != rootPath)
                        {
                            var lastFwdSlash = displayedPath.value.lastIndexOf("/");
                            var backItem = document.createElement("li");
                            backItem.textContent = "..";
                            backItem.value = 0;
                            backItem.setAttribute('data-item-type', 'd');
                            backItem.setAttribute('data-item-path', displayedPath.value.substr(0, lastFwdSlash));
                            contentsList.appendChild(backItem);
                        }
                        for (var i=0; i<payload.size(); i++)
                        {
                            var mikiEl = payload.get(i);
                            var listItem = document.createElement("li");
                            listItem.textContent = mikiEl.name;
                            listItem.value = i;
                            listItem.setAttribute(
                                'data-item-type',
                                (mikiEl.type == Module.ResourceType.Folder ? 'd' : 'p')
                            );
                            listItem.setAttribute('data-item-path', mikiEl.path);
                            contentsList.appendChild(listItem);
                        }
                    },
                    onPage: function(payload) {
                        contentPage.innerHTML = payload;
                    },
                    onError: function(url, status) {
                        var errorStr = "ERROR: '";
                        errorStr += url;
                        errorStr += "' (";
                        errorStr += status;
                        errorStr += ")";

                        alert(errorStr);
                    },
                });

                JSAccessorInst = new JSAccessor;
                displayedPath.value = rootPath;

                JSAccessorInst.get(rootPath, Module.ResourceType.Folder);

            }
        };
    </script>
    <script async type="text/javascript" src="miki.js"></script>
</html>


